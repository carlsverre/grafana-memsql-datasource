{"version":3,"sources":["../src/datasource.js"],"names":[],"mappings":";;;;;;;;;;;;;AAAQ;;AACD;;;;;;;;;;;;;;;;;;;;;yCAEM;AACT,yBADS,iBACT,CAAY,gBAAZ,EAA8B,EAA9B,EAAkC,UAAlC,EAA8C,WAA9C,EAA2D;0CADlD,mBACkD;;AACvD,yBAAK,IAAL,GAAY,iBAAiB,IAAjB,CAD2C;AAEvD,yBAAK,GAAL,GAAW,iBAAiB,GAAjB,CAF4C;AAGvD,yBAAK,IAAL,GAAY,iBAAiB,IAAjB,CAH2C;AAIvD,yBAAK,CAAL,GAAS,EAAT,CAJuD;AAKvD,yBAAK,UAAL,GAAkB,UAAlB,CALuD;AAMvD,yBAAK,WAAL,GAAmB,WAAnB,CANuD;iBAA3D;;;;;6BADS;;qDAWQ;AACb,+BAAO,KAAK,UAAL,CAAgB,iBAAhB,CAAkC;AACrC,iCAAK,KAAK,GAAL,GAAW,WAAX;AACL,oCAAQ,KAAR;yBAFG,EAGJ,IAHI,CAIH,oBAAY;AACR,gCAAI,SAAS,MAAT,KAAoB,GAApB,EAAyB;AACzB,oCAAI,OAAO,SAAS,IAAT,CADc;AAEzB,oCAAI,QAAQ,KAAK,OAAL,KAAiB,mBAAjB,EAAsC;AAC9C,2CAAO;AACH,gDAAQ,SAAR;AACA,+CAAO,SAAP;AACA,iDAAS,sCAAT;qCAHJ,CAD8C;iCAAlD;6BAFJ;;AAWA,mCAAO;AACH,wCAAQ,OAAR;AACA,uCAAO,mBAAP;AACA,yCAAS,4DAAT;6BAHJ,CAZQ;yBAAZ,EAkBA;mCAAQ;AACJ,wCAAQ,OAAR;AACA,uCAAO,mBAAP;AACA,yCAAS,oEAAT;;yBAHJ,CAtBJ,CADa;;;;0CA+BX,SAAS;;;AACX,gCAAQ,GAAR,CAAY,OAAZ,EADW;AAEX,4BAAI,UAAU,EAAE,QAAQ,OAAR,CAAF,CACT,MADS,CACF;mCAAK,CAAC,EAAE,IAAF,IAAU,EAAE,MAAF;yBAAhB,CADE,CAET,GAFS,CAEL;mCAAM;AACP,uCAAO,EAAE,KAAF,IAAW,EAAE,KAAF;AAClB,qCAAK,MAAK,WAAL,CAAiB,OAAjB,CAAyB,EAAE,MAAF,CAA9B;;yBAFC,CAFK,CAMT,KANS,EAAV,CAFO;;AAUX,4BAAI,QAAQ,MAAR,KAAmB,CAAnB,EAAsB;AACtB,mCAAO,KAAK,CAAL,CAAO,IAAP,CAAY,EAAE,MAAM,EAAN,EAAd,CAAP,CADsB;yBAA1B;;AAIA,+BAAO,KAAK,UAAL,CAAgB,iBAAhB,CAAkC;AACrC,iCAAK,KAAK,GAAL,GAAW,iBAAX;AACL,kCAAM;AACF,yCAAS,OAAT;AACA,4CAAY;;AAER,0CAAM,QAAQ,KAAR,CAAc,IAAd,CAAmB,OAAnB,EAAN;AACA,wCAAI,QAAQ,KAAR,CAAc,EAAd,CAAiB,OAAjB,EAAJ;AACA,8CAAU,cAAc,QAAQ,QAAR,CAAxB;iCAJJ;6BAFJ;AASA,oCAAQ,MAAR;AACA,qCAAS,EAAE,gBAAgB,kBAAhB,EAAX;yBAZG,CAAP,CAdW;;;;uBA1CN","file":"datasource.js","sourcesContent":["import {parseInterval} from \"./util\";\nimport _ from \"lodash\";\n\nexport class GenericDatasource {\n    constructor(instanceSettings, $q, backendSrv, templateSrv) {\n        this.type = instanceSettings.type;\n        this.url = instanceSettings.url;\n        this.name = instanceSettings.name;\n        this.q = $q;\n        this.backendSrv = backendSrv;\n        this.templateSrv = templateSrv;\n    }\n\n    // Used for testing datasource in datasource configuration pange\n    testDatasource() {\n        return this.backendSrv.datasourceRequest({\n            url: this.url + '/grafana/',\n            method: 'GET'\n        }).then(\n            response => {\n                if (response.status === 200) {\n                    var data = response.data;\n                    if (data && data.service === \"Memlytics Grafana\") {\n                        return {\n                            status: \"success\",\n                            title: \"Success\",\n                            message: \"Connected to MemSQL analytics proxy.\",\n                        };\n                    }\n                }\n\n                return {\n                    status: \"error\",\n                    title: \"Connection failed\",\n                    message: \"Failed to find MemSQL analytics proxy at the provided url.\",\n                };\n            },\n            err => ({\n                status: \"error\",\n                title: \"Connection failed\",\n                message: \"Could not connect to a MemSQL analytics proxy at the provided url.\",\n            })\n        );\n    }\n\n    query(options) {\n        console.log(options);\n        var queries = _(options.targets)\n            .filter(t => !t.hide && t.target)\n            .map(t => ({\n                alias: t.alias || t.refId,\n                sql: this.templateSrv.replace(t.target),\n            }))\n            .value();\n\n        if (queries.length === 0) {\n            return this.q.when({ data: [] });\n        }\n\n        return this.backendSrv.datasourceRequest({\n            url: this.url + '/grafana/query/',\n            data: {\n                queries: queries,\n                timeWindow: {\n                    // convert timestamps to milliseconds since epoch\n                    from: options.range.from.valueOf(),\n                    to: options.range.to.valueOf(),\n                    interval: parseInterval(options.interval)\n                }\n            },\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' }\n        });\n    }\n}\n"]}